{{ config(
    indexes = [{'columns':['_airbyte_emitted_at'],'type':'btree'}],
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_public",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
-- depends_on: {{ source('public', '_airbyte_raw_placements') }}
select
    {{ json_extract_scalar('_airbyte_data', ['placementId'], ['placementId']) }} as placementid,
    {{ json_extract_scalar('_airbyte_data', ['job', 'jobId'], ['job_jobId']) }} as job_jobId,
    {{ json_extract_scalar('_airbyte_data', ['job', 'source'], ['job_source']) }} as job_source,
    {{ json_extract_scalar('_airbyte_data', ['type'], ['type']) }} as {{ adapter.quote('type') }},
    {{ json_extract_scalar('_airbyte_data', ['owner', 'email'], ['owner_email']) }} as owner_email,
    {{ json_extract_scalar('_airbyte_data', ['owner', 'userId'], ['owner_userId']) }} as owner_userId,
    {{ json_extract_scalar('_airbyte_data', ['owner', 'lastName'], ['owner_lastName']) }} as owner_lastName,
    {{ json_extract_scalar('_airbyte_data', ['owner', 'firstName'], ['owner_firstName']) }} as owner_firstName,
    {{ json_extract_scalar('_airbyte_data', ['salary', 'fee'], ['salary_fee']) }} as salary_fee,
    {{ json_extract_scalar('_airbyte_data', ['salary', 'base'], ['salary_base']) }} as salary_base,
    {{ json_extract_scalar('_airbyte_data', ['salary', 'total'], ['salary_total']) }} as salary_total,
    {{ json_extract_scalar('_airbyte_data', ['status', 'name'], ['status_name']) }} as status_name,
    {{ json_extract_scalar('_airbyte_data', ['status', 'statusId'], ['status_statusId']) }} as status_statusId,
    {{ json_extract_scalar('_airbyte_data', ['company', 'companyId'], ['company_companyId']) }} as company_companyId,
    {{ json_extract_scalar('_airbyte_data', ['company', 'name'], ['company_name']) }} as company_name,
    {{ json_extract_scalar('_airbyte_data', ['contact', 'email'], ['contact_email']) }} as contact_email,
    {{ json_extract_scalar('_airbyte_data', ['contact', 'lastName'], ['contact_lastName']) }} as contact_lastName,
    {{ json_extract_scalar('_airbyte_data', ['contact', 'contactId'], ['contact_contactId']) }} as contact_contactId,
    {{ json_extract_scalar('_airbyte_data', ['contact', 'firstName'], ['contact_firstName']) }} as contact_firstName,
    {{ json_extract_scalar('_airbyte_data', ['JobTitle'], ['jobTitle']) }} as jobTitle,
    {{ json_extract_scalar('_airbyte_data', ['candidate', 'email'], ['candidate_email']) }} as candidate_email,
    {{ json_extract_scalar('_airbyte_data', ['candidate', 'userId'], ['candidate_candidateId']) }} as candidate_candidateId,
    {{ json_extract_scalar('_airbyte_data', ['candidate', 'lastName'], ['candidate_lastName']) }} as candidate_lastName,
    {{ json_extract_scalar('_airbyte_data', ['candidate', 'firstName'], ['candidate_firstName']) }} as candidate_firstName,
    {{ json_extract_scalar('_airbyte_data', ['candidate', 'source'], ['candidate_source']) }} as candidate_source,
    {{ json_extract_scalar('_airbyte_data', ['createdAt'], ['createdAt']) }} as createdAt,
    {{ json_extract_scalar('_airbyte_data', ['startDate'], ['startDate']) }} as startDate,
    {{ json_extract_scalar('_airbyte_data', ['updatedAt'], ['updatedAt']) }} as updatedAt,
    {{ json_extract_array('_airbyte_data', ['recruiters'], ['recruiters']) }} as recruiters,
    {{ json_extract_scalar('_airbyte_data', ['chargeCurrency'], ['chargeCurrency']) }} as chargeCurrency,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'url'], ['workplaceAddress_url']) }} as workplaceAddress_url,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'city'], ['workplaceAddress_city']) }} as workplaceAddress_city,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'name'], ['workplaceAddress_name']) }} as workplaceAddress_name,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'street'], ['workplaceAddress_street']) }} as workplaceAddress_street,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'country'], ['workplaceAddress_country']) }} as workplaceAddress_country,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'postcode'], ['workplaceAddress_postcode']) }} as workplaceAddress_postcode,
    {{ json_extract_scalar('_airbyte_data', ['workplaceAddress', 'postalCode'], ['workplaceAddress_postalCode']) }} as workplaceAddress_postalCode,
    {{ json_extract_array('_airbyte_data', ['custom'], ['custom']) }} as custom,
    {{ json_extract_scalar('_airbyte_data', ['updatedBy', 'email'], ['updatedBy_email']) }} as updatedBy_email,
    {{ json_extract_scalar('_airbyte_data', ['updatedBy', 'userId'], ['updatedBy_userId']) }} as updatedBy_userId,
    {{ json_extract_scalar('_airbyte_data', ['updatedBy', 'lastName'], ['updatedBy_lastName']) }} as updatedBy_lastName,
    {{ json_extract_scalar('_airbyte_data', ['updatedBy', 'firstName'], ['updatedBy_firstName']) }} as updatedBy_firstName,
    {{ json_extract_scalar('_airbyte_data', ['paymentType'], ['paymentType']) }} as paymentType,
    {{ json_extract_scalar('_airbyte_data', ['billing', 'email'], ['billing_email']) }} as billing_email,
    {{ json_extract_scalar('_airbyte_data', ['billing', 'terms'], ['billing_terms']) }} as billing_terms,
    {{ json_extract_scalar('_airbyte_data', ['billing', 'dueDate'], ['billing_dueDate']) }} as billing_dueDate,
    {{ json_extract_scalar('_airbyte_data', ['feeSplit'], ['feeSplit']) }} as feeSplit,
    {{ json_extract_scalar('_airbyte_data', ['createdBy', 'email'], ['createdBy_email']) }} as createdBy_email,
    {{ json_extract_scalar('_airbyte_data', ['createdBy', 'userId'], ['createdBy_userId']) }} as createdBy_userId,
    {{ json_extract_scalar('_airbyte_data', ['createdBy', 'lastName'], ['createdBy_lastName']) }} as createdBy_lastName,
    {{ json_extract_scalar('_airbyte_data', ['createdBy', 'firstName'], ['createdBy_firstName']) }} as createdBy_firstName,
    {{ json_extract_scalar('_airbyte_data', ['contractRate', 'onCosts'], ['contractRate_onCosts']) }} as contractRate_onCosts,
    {{ json_extract_scalar('_airbyte_data', ['contractRate', 'ratePer'], ['contractRate_ratePer']) }} as contractRate_ratePer,
    {{ json_extract_scalar('_airbyte_data', ['contractRate', 'onCostsType'], ['contractRate_onCostsType']) }} as contractRate_onCostsType,
    {{ json_extract_scalar('_airbyte_data', ['contractRate', 'candidateRate'], ['contractRate_candidateRate']) }} as contractRate_candidateRate,
    {{ json_extract_array('_airbyte_data', ['applications'], ['applications']) }} as applications,
    {{ json_extract_scalar('_airbyte_data', ['summary'], ['summary']) }} as summary,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ source('public', '_airbyte_raw_placements') }} as table_alias
-- placements
where 1 = 1
{{ incremental_clause('_airbyte_emitted_at', this) }}

